var i_fighter,i_fighter2,i_fighter1,i_fighter_afterImage,i_fighterA,i_fighterA_afterImage,i_explosion,i_ui_main,i_ui_main_on,i_ui_main_life2,i_ui_main_life3,i_ui_title_push,bullet,ground,ground2,ring,title,gameover,boss2,boss2_arm_left,boss2_arm_right,missile,endroll,logo,v_fighter,v_boss2,v_armL,v_armR,v_n_bulletsSpeed,v_moveUD,v_moveLR,v_ring,d_fighter,s_shot,s_hit,s_explosion,s_speedup,s_ready,s_bgm,s_damage,s_title,s_end,Scroll_Y=0,ui_X=1376,end_Y=1e3,boss2_entryY=-700,missileY=-400,n_explosion=0,n_life=32,p_hp_boss2=1e3,h_boss2="entry",arrPoints_fighter=[],bullets=[],e_radius=1,is_cooldown=!0,is_ringEffect=!1,is_acceleration=!1,is_respawn=!1,state_scene="title",timer_accelerarion=0,timer_cooldown=0,timer_respawn_boss2=0;function preload(){i_fighter=loadImage("fighter.png"),i_fighter2=loadImage("fighter2.png"),i_fighter1=loadImage("fighter1.png"),i_fighter_afterImage=loadImage("fighter.png"),i_fighterA=loadImage("fighter.png"),i_fighterA_afterImage=loadImage("fighter.png"),i_explosion=loadImage("explosion.png"),i_ui_title_push=loadImage("push_enterkey.png"),boss2=loadImage("boss2.png"),boss2_arm_left=loadImage("boss2_arm_left.png"),boss2_arm_right=loadImage("boss2_arm_right.png"),missile=loadImage("missile.png"),title=loadImage("title.png"),bullet=loadImage("bullet.png"),ground=loadImage("ground.png"),ground2=loadImage("ground2.png"),ring=loadImage("ring.png"),endroll=loadImage("endroll.jpg"),gameover=loadImage("gameover.png"),logo=loadImage("logo.png"),i_ui_main=loadImage("ui_main.png"),i_ui_main_on=loadImage("ui_main_on.png"),i_ui_main_life2=loadImage("ui_main_life2.png"),i_ui_main_life3=loadImage("ui_main_life3.png"),s_shot=loadSound("shot.mp3"),s_hit=loadSound("hit.mp3"),s_explosion=loadSound("explosion.mp3"),s_speedup=loadSound("speedup.mp3"),s_ready=loadSound("ready.mp3"),s_damage=loadSound("damage.mp3"),s_bgm=loadSound("bgm.mp3"),s_title=loadSound("title.mp3"),s_end=loadSound("end.mp3")}function setup(){i_fighter_afterImage.filter("gray"),i_fighterA_afterImage.filter("gray"),createCanvas(1076,716),v_fighter=createVector(224,300),v_boss2=createVector(0,0),v_armL=createVector(165,320),v_armR=createVector(200,320);for(var e=0;e<3;e++)append(arrPoints_fighter,v_fighter);v_n_bulletsSpeed=createVector(0,0),v_moveUD=createVector(0,0),v_moveLR=createVector(0,0),v_ring=createVector(0,0),s_shot.setVolume(.03),s_hit.setVolume(.04),s_speedup.setVolume(.1),s_ready.setVolume(.1),s_explosion.setVolume(.2),s_damage.setVolume(.05),s_bgm.setVolume(.05),s_bgm.loop(),s_title.setVolume(.1),s_end.setVolume(.1)}function default_loop(){image(ground,0,Scroll_Y),image(ground,0,Scroll_Y-716),Scroll_Y+=8,v_moveUD.set(0,6),v_moveLR.set(6,0),keyIsPressed&&(fighterMove(),keyIsDown(32)&&frameCount%10==0&&(fire(),s_shot.play())),v_n_bulletsSpeed.set(0,-18);for(var e=0;e<bullets.length;e++)image(bullet,bullets[e].x,bullets[e].y,22,45),bullets[e].add(v_n_bulletsSpeed);30<=n_life?image(i_fighter,v_fighter.x,v_fighter.y,90,90):10<=n_life&&n_life<30?image(i_fighter2,v_fighter.x,v_fighter.y,90,90):image(i_fighter1,v_fighter.x,v_fighter.y,90,90)}function acceleration_loop(){image(ground2,0,Scroll_Y),image(ground2,0,Scroll_Y-716),Scroll_Y+=.5,v_moveUD.set(0,16),v_moveLR.set(16,0),keyIsPressed&&(fighterMove(),keyIsDown(32)&&frameCount%3==0&&fire()),v_n_bulletsSpeed.set(0,-.2);for(var e=0;e<bullets.length;e++)image(bullet,bullets[e].x,bullets[e].y,22,45),bullets[e].add(v_n_bulletsSpeed);for(e=0;e<3;e++)image(i_fighter_afterImage,arrPoints_fighter[e].x,arrPoints_fighter[e].y,90,90);frameCount%3==0&&(shorten(arrPoints_fighter),arrPoints_fighter.unshift(v_fighter.copy())),image(i_fighterA,v_fighter.x,v_fighter.y,90,90)}function mainGame(){if(background(255),imageMode(CORNER),716<Scroll_Y&&(Scroll_Y=0),448<v_fighter.x&&v_fighter.set(448,v_fighter.y),v_fighter.x<0&&v_fighter.set(0,v_fighter.y),626<v_fighter.y&&v_fighter.set(v_fighter.x,626),v_fighter.y<0&&v_fighter.set(v_fighter.x,0),is_acceleration?acceleration_loop():default_loop(),is_ringEffect&&(e_radius+=150,s_speedup.play()),1600<e_radius&&(is_acceleration=!(is_ringEffect=!(e_radius=1))),is_acceleration&&(timer_accelerarion+=1),90<timer_accelerarion&&(timer_accelerarion=0,is_cooldown=is_acceleration=!1),600<timer_cooldown&&(is_cooldown=!0,timer_cooldown=0,s_ready.play()),p_hp_boss2<0&&(s_explosion.play(),h_boss2="broken",p_hp_boss2=0),"alive"===h_boss2){for(var e=0;t<bullets.length;t++)collideRectRect(220,250,100,20,bullets[e].x,bullets[e].y,22,45)&&(p_hp_boss2-=1,s_hit.play());p_hp_boss2<500&&collideRectRect(230,missileY,96,256,v_fighter.x+20,v_fighter.y+20,50,50)&&(n_life-=1,s_hit.play()),collideRectRect(v_fighter.x+20,v_fighter.y+20,50,50,v_armL.x+10,v_armL.y+50,100,100)&&!1===is_acceleration&&(n_life-=1,s_damage.play()),collideRectRect(v_fighter.x+20,v_fighter.y+20,50,50,v_armR.x+55,v_armR.y+50,100,100)&&!1===is_acceleration&&(n_life-=1,s_damage.play())}if("alive"===h_boss2){var _=100*sin(frameCount/100)-100;if(is_acceleration)image(boss2_arm_left,165,320+_,180,180),image(boss2_arm_right,200,320+_,180,180);else{p_hp_boss2<500&&(716<(missileY+=4)&&(missileY=-800),image(missile,150,missileY));var i=frameCount/38,s=frameCount/40;v_armL.set(165+300*sin(i),_+320+300*cos(i)),v_armR.set(200+300*cos(s),_+320+300*sin(s)),image(boss2_arm_left,v_armL.x,v_armL.y,180,180),image(boss2_arm_right,v_armR.x,v_armR.y,180,180)}v_boss2.set(0,_),image(boss2,v_boss2.x,v_boss2.y,538,358)}else"broken"===h_boss2?(4===n_explosion&&(h_boss2="dead",is_respawn=!(n_explosion=0)),image(i_explosion,v_boss2.x,v_boss2.y-100,512,512,256*n_explosion,0,256,256),frameCount%15==0&&(n_explosion+=1)):"dead"===h_boss2?300<timer_respawn_boss2&&(is_respawn=!1,state_scene="end",timer_respawn_boss2=0,p_hp_boss2=1e3,h_boss2="entry"):"entry"===h_boss2&&(image(boss2_arm_left,165,320+boss2_entryY,180,180),image(boss2_arm_right,200,320+boss2_entryY,180,180),image(boss2,0,boss2_entryY,538,358),0<boss2_entryY?(boss2_entryY=-700,h_boss2="alive"):boss2_entryY+=1);!0===is_respawn&&(timer_respawn_boss2+=1),imageMode(CENTER),image(ring,v_ring.x,v_ring.y,e_radius,e_radius,0,0,500,500),imageMode(CORNER);e=0;for(var t=0;t<bullets.length;t++)bullets[t].y<-45&&(e+=1);for(t=0;t<e;t++)bullets.shift();image(i_ui_main,538,0,538,716),!1===is_cooldown?timer_cooldown+=1:!1===is_acceleration&&image(i_ui_main_on,538,0,538,716),30<=n_life?image(i_ui_main_life3,538,0,538,716):10<=n_life&&n_life<30?image(i_ui_main_life2,538,0,538,716):n_life<0&&(state_scene="gameover",h_boss2="entry",boss2_entryY=-700),fill(72,87,17),rect(730,43,map(p_hp_boss2,0,1e3,0,300),26)}function draw(){"main"===state_scene?mainGame():"end"===state_scene?(s_bgm.stop(),!1===s_end.isPlaying()&&s_end.loop(),background(0),end_Y<-2e3&&image(logo,0,150),image(endroll,0,end_Y),(end_Y-=1)<-3e3&&(end_Y=1e3,h_boss2="entry",state_scene="title",s_end.stop())):"title"===state_scene?(s_bgm.stop(),!1===s_title.isPlaying()&&s_title.loop(),image(title,0,0),image(i_ui_title_push,ui_X,600),ui_X<-737?ui_X=1376:ui_X-=1.5):"gameover"===state_scene&&(s_bgm.stop(),!1===s_title.isPlaying()&&s_title.loop(),image(gameover,0,0),image(i_ui_title_push,ui_X,500),ui_X<-737?ui_X=1376:ui_X-=1.5)}function fire(){append(bullets,createVector(v_fighter.x+34,v_fighter.y-30))}function fighterMove(){"R"===d_fighter?v_fighter.add(v_moveLR):"L"===d_fighter?v_fighter.sub(v_moveLR):"U"===d_fighter?v_fighter.sub(v_moveUD):"D"===d_fighter&&v_fighter.add(v_moveUD)}function keyPressed(){keyCode===RIGHT_ARROW?d_fighter="R":keyCode===LEFT_ARROW?d_fighter="L":keyCode===UP_ARROW?d_fighter="U":keyCode===DOWN_ARROW&&(d_fighter="D"),81===keyCode&&remove(),67===keyCode&&is_cooldown&&(is_ringEffect=!0,v_ring.set(v_fighter.x+45,v_fighter.y+45)),"title"===state_scene&&keyCode===ENTER&&(n_life=32,v_fighter.set(224,300),p_hp_boss2=1e3,missileY=-800,s_title.stop(),s_bgm.play(),state_scene="main"),"gameover"===state_scene&&keyCode===ENTER&&(state_scene="title")}function keyReleased(){keyCode!==RIGHT_ARROW&&keyCode!==LEFT_ARROW&&keyCode!==UP_ARROW&&keyCode!==DOWN_ARROW||(d_fighter="NONE")}
